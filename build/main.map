{"version":3,"sources":["webpack:///webpack/bootstrap 6f4b784d2ab04c91539f","webpack:///external \"express\"","webpack:///external \"passport\"","webpack:///./server/app.js","webpack:///external \"path\"","webpack:///external \"serve-favicon\"","webpack:///external \"morgan\"","webpack:///external \"cookie-parser\"","webpack:///external \"body-parser\"","webpack:///external \"passport-vkontakte\"","webpack:///external \"express-session\"","webpack:///./routes/index.js","webpack:///./routes/users.js","webpack:///./routes/auth.js","webpack:///./config/default.js"],"names":["isProd","VkStrategy","VK_APP_ID","process","env","VK_APP_SECRET","Error","passport","serializeUser","user","done","console","log","deserializeUser","obj","use","clientID","clientSecret","callbackURL","scope","profileFields","verify","accessToken","refreshToken","params","profile","nextTick","app","express","host","HOST","port","PORT","set","path","join","__dirname","logger","cookieParser","bodyParser","json","urlencoded","extended","require","secret","resave","saveUninitialized","initialize","session","static","cfg","dev","listen","err","error","router","Router","get","req","res","next","render","title","ensureAuthenticated","logout","redirect","isAuthenticated","module","exports","send","authenticate","failureRedirect","head","meta","charset","name","content","hid","link","rel","type","href","css","build","vendor","extend","config","ctx","isClient","rules","push","enforce","test","loader","exclude"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6f4b784d2ab04c91539f","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 1\n// module chunks = 0","const isProd = process.env.NODE_ENV === 'production'\n\nimport express from 'express'\nimport path from 'path'\nimport favicon from 'serve-favicon'\nimport logger from 'morgan'\nimport cookieParser from 'cookie-parser'\nimport bodyParser from 'body-parser'\n\nimport passport from 'passport'\n\nimport { Strategy } from 'passport-vkontakte'\n\nconst VkStrategy = Strategy\n\nvar VK_APP_ID = process.env.VK_APP_ID;\nvar VK_APP_SECRET = process.env.VK_APP_SECRET;\n\nif (!VK_APP_ID || !VK_APP_SECRET) {\n    throw new Error('Set VK_APP_ID and VK_APP_SECRET env vars to run the example');\n}\n\n// Passport session setup.\n//   To support persistent login sessions, Passport needs to be able to\n//   serialize users into and deserialize users out of the session.  Typically,\n//   this will be as simple as storing the user ID when serializing, and finding\n//   the user by ID when deserializing.  However, since this example does not\n//   have a database of user records, the complete VK profile is serialized\n//   and deserialized.\npassport.serializeUser(function(user, done) {\n  console.log(user)\n  done(null, user);\n});\n\npassport.deserializeUser(function(obj, done) {\n  done(null, obj);\n});\n\n// Use the VkStrategy within Passport.\n//   Strategies in Passport require a `verify` function, which accept\n//   credentials (in this case, an accessToken, refreshToken, and VK\n//   profile), and invoke a callback with a user object.\npassport.use(new VkStrategy(\n  {\n    clientID: VK_APP_ID,\n    clientSecret: VK_APP_SECRET,\n    callbackURL: \"http://localhost:3000/auth/vk/callback\",\n    scope: ['email'],\n    profileFields: ['email'],\n  },\n  function verify(accessToken, refreshToken, params, profile, done) {\n\n    // asynchronous verification, for effect...\n    process.nextTick(function () {\n\n      // To keep the example simple, the user's VK profile is returned to\n      // represent the logged-in user.  In a typical application, you would want\n      // to associate the VK account with a user record in your database,\n      // and return that user instead.\n      return done(null, profile);\n    });\n  }\n));\n\nconst app = express()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\n\napp.set('port', port)\n\n// view engine setup\napp.set('views', path.join(__dirname, '../views'))\napp.set('view engine', 'jade')\n\n// uncomment after placing your favicon in /public\n//app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\napp.use(logger('dev'))\napp.use(cookieParser())\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({ extended: true }))\n\napp.use(require('express-session')({secret:'keyboard cat', resave: true, saveUninitialized: true}))\napp.use(passport.initialize())\napp.use(passport.session())\n\napp.use(express.static(path.join(__dirname, 'public')))\n\napp.use('/', require('../routes'));\napp.use('/users', require('../routes/users'));\napp.use('/auth', require('../routes/auth'));\n\n// catch 404 and forward to error handler\n// app.use(function(req, res, next) {\n//   var err = new Error('Not Found');\n//   err.status = 404;\n//   next(err);\n// });\n\n// error handler\n// app.use(function(err, req, res, next) {\n//   // set locals, only providing error in development\n//   res.locals.message = err.message;\n//   res.locals.error = req.app.get('env') === 'development' ? err : {};\n//\n//   // render the error page\n//   res.status(err.status || 500);\n//   res.render('error');\n// });\n\n// Start nuxt.js\n// async function start() {\n  // Import and Set Nuxt.js options\n  import cfg from '../config/default.js'\n  // let config = require('../nuxt.config.js')\n  cfg.dev = !isProd\n  // Instanciate nuxt.js\n  // const nuxt = new Nuxt(config)\n  // Add nuxt.js middleware\n  // app.use(nuxt.render)\n  // Listen the server\n  app.listen(port, (err) => {\n    if (err) {\n      console.error(err)\n    }\n\n    if (__DEV__) { // webpack flags!\n      console.log('> in development')\n    }\n\n    console.log(`> listening on port ${port}`)\n  })\n// }\n\n// start()\n\n// module.exports = app;\n\n\n\n// WEBPACK FOOTER //\n// ./server/app.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"serve-favicon\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"serve-favicon\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"passport-vkontakte\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-vkontakte\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 9\n// module chunks = 0","var express = require('express');\nvar router = express.Router();\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n  res.render('index', { title: 'Express', user: req.user });\n});\n\nrouter.get('/account', ensureAuthenticated, function(req, res){\n  res.render('account', { user: req.user });\n});\n\nrouter.get('/login', function(req, res){\n  res.render('login', { user: req.user });\n});\n\nrouter.get('/logout', function(req, res){\n  req.logout();\n  res.redirect('/');\n});\n\n// Simple route middleware to ensure user is authenticated.\n//   Use this route middleware on any resource that needs to be protected.  If\n//   the request is authenticated (typically via a persistent login session),\n//   the request will proceed.  Otherwise, the user will be redirected to the\n//   login page.\nfunction ensureAuthenticated(req, res, next) {\n  if (req.isAuthenticated()) { return next(); }\n  res.redirect('/login')\n}\n\nmodule.exports = router;\n\n\n\n// WEBPACK FOOTER //\n// ./routes/index.js","var express = require('express');\nvar router = express.Router();\n\n/* GET users listing. */\nrouter.get('/', function(req, res, next) {\n  res.send('respond with a resource');\n});\n\nmodule.exports = router;\n\n\n\n// WEBPACK FOOTER //\n// ./routes/users.js","var passport = require('passport');\nvar express = require('express');\nvar router = express.Router();\n\n// GET /auth/vk\n//   Use passport.authenticate() as route middleware to authenticate the\n//   request.  The first step in VK authentication will involve\n//   redirecting the user to vk.com.  After authorization, VK will\n//   redirect the user back to this application at /auth/vk/callback\nrouter.get('/vk',\n  passport.authenticate('vkontakte'),\n  function(req, res){\n    // The request will be redirected to VK for authentication, so this\n    // function will not be called.\n  });\n\n// GET /auth/vk/callback\n//   Use passport.authenticate() as route middleware to authenticate the\n//   request.  If authentication fails, the user will be redirected back to the\n//   login page.  Otherwise, the primary route function function will be called,\n//   which, in this example, will redirect the user to the home page.\nrouter.get('/vk/callback',\n  passport.authenticate('vkontakte', { failureRedirect: '/login' }),\n  function(req, res) {\n    res.redirect('/');\n  });\n\nmodule.exports = router;\n\n\n\n// WEBPACK FOOTER //\n// ./routes/auth.js","export default {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'starter',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Auth project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: ['~assets/css/main.css'],\n  /*\n  ** Add axios globally\n  */\n  build: {\n    vendor: ['axios'],\n    /*\n    ** Run ESLINT on save\n    */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./config/default.js"],"sourceRoot":""}